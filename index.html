<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Toyo ‚Äì Seguimiento (Simple)</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0046BE">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root{--blue:#0046BE;--navy:#002E80;--bg:#F3F5F8;--card:#fff;--border:#d9dde6;--text:#0f172a;--muted:#64748b;--danger:#dc2626}
    *{box-sizing:border-box}
    body{margin:0;padding:14px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:10px;flex-wrap:wrap}
    .brand b{color:var(--blue);font-size:16px}
    .brand div{color:var(--muted);font-size:12px;margin-top:2px}
    .pill{border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 10px;font-size:12px;color:var(--muted);font-weight:800}
    .pill b{color:var(--text)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .tab{border:1px solid var(--border);background:#fff;padding:10px 12px;border-radius:12px;font-weight:900;cursor:pointer;user-select:none}
    .tab.active{background:var(--blue);border-color:var(--blue);color:#fff}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 6px 18px rgba(15,23,42,.06);margin-bottom:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){.grid.two{grid-template-columns:1fr 1fr}.grid.three{grid-template-columns:1fr 1fr 1fr}}
    label{display:block;font-size:12px;color:var(--muted);font-weight:900;margin-bottom:6px}
    input,select,textarea{width:100%;border:1px solid var(--border);border-radius:12px;padding:12px;font-size:15px;background:#fff;outline:none}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{border:0;border-radius:12px;padding:12px 14px;font-weight:900;cursor:pointer}
    .btn.primary{background:var(--blue);color:#fff}
    .btn.dark{background:var(--navy);color:#fff}
    .btn.ghost{background:#fff;border:1px solid var(--border)}
    .btn.danger{background:var(--danger);color:#fff}
    .mini{font-size:12px;color:var(--muted)}
    .hide{display:none !important}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#fff}
    th,td{padding:10px;border-bottom:1px solid var(--border);font-size:13px;vertical-align:top}
    th{background:#f8fafc;text-align:left;color:var(--muted);font-weight:900}
    tr:last-child td{border-bottom:0}
    .right{text-align:right}
    .progress{height:12px;background:#e8edf6;border-radius:999px;overflow:hidden;border:1px solid var(--border)}
    .bar{height:100%;width:0%;background:var(--blue)}
    .notice{padding:10px 12px;border-radius:12px;border:1px dashed var(--border);background:#fff;color:var(--muted);font-size:12px;line-height:1.35}
    a{color:var(--blue);font-weight:900;text-decoration:none}
  </style>
</head>
<body>

  <div class="top">
    <div class="brand">
      <b>Toyo ‚Äì Seguimiento (Simple)</b>
      <div id="who">Selecciona vendedor</div>
    </div>
    <div class="row">
      <span class="pill">Red: <b id="net">‚Äî</b></span>
      <span class="pill">Backend: <b id="apiStatus">‚Äî</b></span>
    </div>
  </div>

  <div class="card">
    <div class="grid two">
      <div>
        <label>Vendedor</label>
        <select id="sellerSel"></select>
        <div class="mini">No hay login. Solo selecciona tu nombre.</div>
      </div>
      <div>
        <label>PIN Admin (solo si eres admin)</label>
        <input id="adminPin" placeholder="PIN" inputmode="numeric" />
        <div class="mini">Gu√°rdalo en este dispositivo (no se sube).</div>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <button class="btn ghost" id="btnSavePin">Guardar PIN</button>
      <button class="btn ghost" id="btnClearPin">Borrar PIN</button>
    </div>
  </div>

  <div class="tabs" id="tabs"></div>

  <!-- VISITA -->
  <section id="view_visita">
    <div class="card">
      <div class="grid two">
        <div>
          <label>Cliente visitado</label>
          <input id="client" placeholder="Ej. Sushi Factory / HEB..." list="clientsList" />
          <datalist id="clientsList"></datalist>
        </div>
        <div>
          <label>Motivo</label>
          <select id="reason">
            <option value="">Selecciona‚Ä¶</option>
            <option>Entrega de producto</option>
            <option>Cobranza</option>
            <option>Negociaci√≥n</option>
            <option>Degustaci√≥n</option>
            <option>Cotizaci√≥n</option>
            <option>Visita de seguimiento</option>
            <option>Otro</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px;">
        <label>Comentarios</label>
        <textarea id="comments" placeholder="Acuerdos, pendientes, observaciones‚Ä¶"></textarea>
      </div>

      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="btnStart">‚ñ∂ Iniciar (GPS)</button>
        <button class="btn danger" id="btnEnd" disabled>‚ñ† Terminar (Guardar)</button>
        <button class="btn ghost" id="btnClear">Limpiar</button>
      </div>

      <div class="grid two" style="margin-top:12px;">
        <div class="pill">Inicio: <b id="startInfo">‚Äî</b></div>
        <div class="pill">Duraci√≥n: <b id="durInfo">‚Äî</b></div>
      </div>

      <div class="notice" style="margin-top:12px;">
        Se guarda en Supabase sin login. Admin ve por PIN.
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <b>√öltimas visitas (local en este celular)</b>
        <button class="btn ghost" id="btnMyExcel">‚¨á Excel</button>
      </div>
      <div id="myVisits" style="margin-top:10px;"></div>
    </div>
  </section>

  <!-- META -->
  <section id="view_meta" class="hide">
    <div class="card">
      <div class="grid three">
        <div>
          <label>Mes</label>
          <input id="goalMonth" type="month" />
        </div>
        <div>
          <label>Meta del mes (MXN)</label>
          <input id="goalVal" type="number" inputmode="decimal" placeholder="Ej. 500000" />
        </div>
        <div style="display:flex;align-items:flex-end;gap:10px;">
          <button class="btn dark" id="btnSaveGoal">Guardar meta</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="grid three">
        <div>
          <label>Fecha</label>
          <input id="saleDate" type="date" />
        </div>
        <div>
          <label>Venta del d√≠a (MXN)</label>
          <input id="saleAmt" type="number" inputmode="decimal" placeholder="Ej. 25000" />
        </div>
        <div>
          <label>Nota (opcional)</label>
          <input id="saleNote" placeholder="Ej. pedido grande / promo..." />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="btn primary" id="btnSaveSale">Guardar venta</button>
        <button class="btn ghost" id="btnSalesExcel">‚¨á Excel (local)</button>
      </div>
    </div>

    <div class="card">
      <b>Progreso del mes (local)</b>
      <div class="mini" id="metaSummary" style="margin:6px 0 10px;">‚Äî</div>
      <div class="progress"><div class="bar" id="metaBar"></div></div>
      <div id="salesTable" style="margin-top:12px;"></div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="view_admin" class="hide">
    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <b>Admin ‚Äì Visitas (PIN)</b>
        <div class="row">
          <button class="btn ghost" id="btnAdminReload">üîÑ Recargar</button>
          <button class="btn ghost" id="btnAdminExcel">‚¨á Excel</button>
        </div>
      </div>

      <div class="grid two" style="margin-top:10px;">
        <div>
          <label>Desde</label>
          <input id="adminFrom" type="date" />
        </div>
        <div>
          <label>Hasta</label>
          <input id="adminTo" type="date" />
        </div>
      </div>

      <div id="adminTable" style="margin-top:12px;"></div>
      <div class="notice" style="margin-top:12px;">
        Admin lee por <b>RPC</b> con PIN. Si PIN est√° mal, te dir√° ‚ÄúPIN incorrecto‚Äù.
      </div>
    </div>
  </section>

<script>
/* =========================
   CONFIG (PON TUS DATOS)
   ========================= */
const SUPABASE_URL = "PEGA_AQUI_TU_SUPABASE_URL";
const SUPABASE_ANON_KEY = "PEGA_AQUI_TU_ANON_KEY";

/* ========================= */
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const $ = (id)=>document.getElementById(id);

function setNet(){ $("net").textContent = navigator.onLine ? "Online" : "Offline"; }
addEventListener("online", setNet); addEventListener("offline", setNet); setNet();

function todayISO(){
  const d=new Date(); const mm=String(d.getMonth()+1).padStart(2,"0"); const dd=String(d.getDate()).padStart(2,"0");
  return `${d.getFullYear()}-${mm}-${dd}`;
}
function monthISO(){
  const d=new Date(); const mm=String(d.getMonth()+1).padStart(2,"0");
  return `${d.getFullYear()}-${mm}`;
}
function monthToDate(m){ return `${m}-01`; }
function fmtDT(v){ try{return new Date(v).toLocaleString("es-MX")}catch(e){return String(v||"")} }
function fmtNum(n){ return Number(n||0).toLocaleString("es-MX",{maximumFractionDigits:2}); }
function exportExcel(name, rows){
  const ws = XLSX.utils.json_to_sheet(rows || []);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Datos");
  XLSX.writeFile(wb, `${name}_${new Date().toISOString().slice(0,10)}.xlsx`);
}
function deviceId(){
  const k="toyo_device_id_simple";
  let v=localStorage.getItem(k);
  if(!v){ v="DEV-"+Math.random().toString(16).slice(2)+"-"+Date.now().toString(16); localStorage.setItem(k,v); }
  return v;
}

/* ===== Sellers list ===== */
const SELLERS = [
  "Hector Beristain (Admin)",
  "Aguilar Neri Daniel",
  "De la Cruz Ponce Julio Cesar",
  "Garibay Ortiz Sergio Joel",
  "Perez Mar Alan Roberto",
  "Reynoso Aguilar Maricela",
  "Sandra Navarro Navarro",
  "Arcenio Aguirre Ojeda",
  "Velez Castellanos Antonio",
  "Yepez Mora Oscar Alberto",
  "Hernandez Gonzalez Miguel Angel",
  "Esmeralda Sanchez"
];

const SELLER_KEY="toyo_seller_simple";
function getSeller(){ return localStorage.getItem(SELLER_KEY) || ""; }
function setSeller(v){ localStorage.setItem(SELLER_KEY, v); $("who").textContent = v ? `Vendedor: ${v}` : "Selecciona vendedor"; }
function buildSellerSelect(){
  $("sellerSel").innerHTML = `<option value="">Selecciona‚Ä¶</option>` + SELLERS.map(s=>`<option>${s}</option>`).join("");
  $("sellerSel").value = getSeller();
  setSeller(getSeller());
  $("sellerSel").onchange = ()=> setSeller($("sellerSel").value);
}
buildSellerSelect();

/* ===== Admin PIN local ===== */
const PIN_KEY="toyo_admin_pin";
$("adminPin").value = localStorage.getItem(PIN_KEY) || "";
$("btnSavePin").onclick=()=>{ localStorage.setItem(PIN_KEY, $("adminPin").value.trim()); alert("PIN guardado"); };
$("btnClearPin").onclick=()=>{ localStorage.removeItem(PIN_KEY); $("adminPin").value=""; alert("PIN borrado"); };

/* ===== Tabs ===== */
function setTabs(){
  $("tabs").innerHTML = "";
  const tabs = [
    {id:"visita", label:"üß≠ Visita"},
    {id:"meta", label:"üéØ Meta"},
    {id:"admin", label:"üîí Admin"}
  ];
  tabs.forEach(t=>{
    const el=document.createElement("div");
    el.className="tab";
    el.textContent=t.label;
    el.onclick=()=>openTab(t.id);
    $("tabs").appendChild(el);
  });
  openTab("visita");
}
function openTab(id){
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  [...$("tabs").children].forEach(x=>{
    const tx=x.textContent;
    if((tx.includes("Visita") && id==="visita") || (tx.includes("Meta") && id==="meta") || (tx.includes("Admin") && id==="admin")){
      x.classList.add("active");
    }
  });
  $("view_visita").classList.toggle("hide", id!=="visita");
  $("view_meta").classList.toggle("hide", id!=="meta");
  $("view_admin").classList.toggle("hide", id!=="admin");

  if(id==="visita") renderLocalVisits();
  if(id==="meta") renderLocalMeta();
  if(id==="admin") adminReload();
}
setTabs();

/* ===== Backend status ===== */
(async ()=>{
  try{
    const { data, error } = await sb.rpc("ping");
    $("apiStatus").textContent = (error ? "ERROR" : (data || "OK"));
  }catch(e){
    $("apiStatus").textContent = "ERROR";
  }
})();

/* ===== Clients (optional) ===== */
(async ()=>{
  try{
    const { data } = await sb.from("clients").select("name").eq("active", true).order("name",{ascending:true}).limit(300);
    const dl=$("clientsList"); dl.innerHTML="";
    (data||[]).forEach(c=>{ const op=document.createElement("option"); op.value=c.name; dl.appendChild(op); });
  }catch(e){}
})();

/* ===== VISITS flow ===== */
let current=null, timer=null;
function getGeo(){
  return new Promise((resolve,reject)=>{
    if(!navigator.geolocation) return reject(new Error("Sin geolocalizaci√≥n"));
    navigator.geolocation.getCurrentPosition(
      p=>resolve({lat:p.coords.latitude,lng:p.coords.longitude,acc:p.coords.accuracy}),
      e=>reject(new Error(e.message||"Error GPS")),
      { enableHighAccuracy:true, timeout:15000, maximumAge:0 }
    );
  });
}
function clearVisit(){
  current=null;
  $("startInfo").textContent="‚Äî";
  $("durInfo").textContent="‚Äî";
  $("btnStart").disabled=false;
  $("btnEnd").disabled=true;
  if(timer){ clearInterval(timer); timer=null; }
}
$("btnClear").onclick=()=>{
  $("client").value=""; $("reason").value=""; $("comments").value="";
  clearVisit();
};

const LOCAL_VISITS_KEY="toyo_local_visits_v1";
function getLocalVisits(){ try{return JSON.parse(localStorage.getItem(LOCAL_VISITS_KEY)||"[]")}catch(e){return []} }
function setLocalVisits(v){ localStorage.setItem(LOCAL_VISITS_KEY, JSON.stringify(v)); }
function renderLocalVisits(){
  const data = getLocalVisits().slice(0,20);
  window.__localVisits = data;
  if(!data.length){ $("myVisits").innerHTML = `<div class="mini">Sin visitas locales.</div>`; return; }
  let html=`<table><thead><tr><th>Fecha</th><th>Cliente</th><th>Motivo</th><th class="right">Dur</th></tr></thead><tbody>`;
  data.forEach(r=>{
    html+=`<tr><td>${fmtDT(r.created_at)}</td><td>${r.client_name}</td><td>${r.reason}</td><td class="right">${r.duration_min}</td></tr>`;
  });
  html+=`</tbody></table>`;
  $("myVisits").innerHTML = html;
}
$("btnMyExcel").onclick=()=> exportExcel("Visitas_Local", window.__localVisits || []);

$("btnStart").onclick=async ()=>{
  const seller=getSeller();
  if(!seller) return alert("Selecciona vendedor.");
  const client=$("client").value.trim();
  const reason=$("reason").value.trim();
  if(!client) return alert("Escribe el cliente.");
  if(!reason) return alert("Selecciona el motivo.");

  try{
    $("btnStart").disabled=true;
    const g=await getGeo();
    const start=new Date();
    current={
      seller,
      client_name:client,
      reason,
      comments:$("comments").value.trim(),
      start_ts:start.toISOString(),
      start_ms:Date.now(),
      start_lat:g.lat, start_lng:g.lng, start_acc:g.acc,
      device_id:deviceId()
    };
    $("startInfo").textContent = `${fmtDT(current.start_ts)} | ¬±${Math.round(g.acc)}m`;
    $("btnEnd").disabled=false;

    timer=setInterval(()=>{
      if(!current) return;
      const min=Math.max(0, Math.round((Date.now()-current.start_ms)/60000));
      $("durInfo").textContent = `${min} min`;
    },1000);

  }catch(e){
    $("btnStart").disabled=false;
    alert(e.message);
  }
};

$("btnEnd").onclick=async ()=>{
  if(!current) return;
  try{
    $("btnEnd").disabled=true;
    const g=await getGeo();
    const end=new Date();
    const duration_min=Math.max(0, Math.round((Date.now()-current.start_ms)/60000));

    const payload={
      seller: current.seller,
      client_name: current.client_name,
      reason: current.reason,
      comments: current.comments,
      start_ts: current.start_ts,
      end_ts: end.toISOString(),
      duration_min,
      start_lat: current.start_lat,
      start_lng: current.start_lng,
      start_acc: current.start_acc,
      end_lat: g.lat,
      end_lng: g.lng,
      end_acc: g.acc,
      device_id: current.device_id
    };

    // guarda en Supabase
    const { error } = await sb.from("visits").insert(payload);
    if(error){ alert("No se pudo guardar en servidor: " + error.message); }

    // guarda local
    const loc = getLocalVisits();
    loc.unshift({ ...payload, created_at: new Date().toISOString() });
    setLocalVisits(loc);

    alert("‚úÖ Visita guardada.");
    clearVisit();
    renderLocalVisits();

  }catch(e){
    alert(e.message);
    $("btnEnd").disabled=false;
  }
};

/* ===== META local + server ===== */
$("goalMonth").value = monthISO();
$("saleDate").value = todayISO();

const LOCAL_META_KEY="toyo_meta_local_v1";
function getMeta(){ try{return JSON.parse(localStorage.getItem(LOCAL_META_KEY)||"{}")}catch(e){return {}} }
function setMeta(v){ localStorage.setItem(LOCAL_META_KEY, JSON.stringify(v)); }

$("btnSaveGoal").onclick=async ()=>{
  const seller=getSeller(); if(!seller) return alert("Selecciona vendedor.");
  const m=$("goalMonth").value; const goal=Number($("goalVal").value||0);
  if(!m) return alert("Selecciona mes.");
  if(goal<=0) return alert("Meta > 0.");
  const monthDate=monthToDate(m);

  // server upsert
  await sb.from("monthly_goals").upsert({ seller, month: monthDate, goal, updated_at: new Date().toISOString() }, { onConflict:"seller,month" });

  // local
  const meta=getMeta();
  meta[`${seller}|goal|${monthDate}`]=goal;
  setMeta(meta);

  alert("‚úÖ Meta guardada.");
  renderLocalMeta();
};

$("btnSaveSale").onclick=async ()=>{
  const seller=getSeller(); if(!seller) return alert("Selecciona vendedor.");
  const d=$("saleDate").value; const amt=Number($("saleAmt").value||0); const note=$("saleNote").value.trim();
  if(!d) return alert("Selecciona fecha.");

  await sb.from("daily_sales").upsert({ seller, sale_date:d, amount:amt, note, updated_at: new Date().toISOString() }, { onConflict:"seller,sale_date" });

  const meta=getMeta();
  meta[`${seller}|sale|${d}`]={amount:amt,note};
  setMeta(meta);

  $("saleAmt").value=""; $("saleNote").value="";
  alert("‚úÖ Venta guardada.");
  renderLocalMeta();
};

$("btnSalesExcel").onclick=()=>{
  const seller=getSeller();
  const meta=getMeta();
  const rows=[];
  Object.keys(meta).forEach(k=>{
    if(k.startsWith(`${seller}|sale|`)){
      const date=k.split("|")[2];
      rows.push({seller, sale_date:date, amount:meta[k].amount, note:meta[k].note});
    }
  });
  exportExcel("Ventas_Local", rows);
};

function renderLocalMeta(){
  const seller=getSeller();
  if(!seller){ $("metaSummary").textContent="Selecciona vendedor."; return; }
  const m=$("goalMonth").value || monthISO();
  const monthDate=monthToDate(m);

  const meta=getMeta();
  const goal=Number(meta[`${seller}|goal|${monthDate}`]||$("goalVal").value||0);
  if(goal) $("goalVal").value=goal;

  const start=monthDate;
  const endD=new Date(monthDate); endD.setMonth(endD.getMonth()+1);
  const end=endD.toISOString().slice(0,10);

  const sales=[];
  Object.keys(meta).forEach(k=>{
    if(k.startsWith(`${seller}|sale|`)){
      const d=k.split("|")[2];
      if(d>=start && d<end) sales.push({sale_date:d, amount:meta[k].amount, note:meta[k].note});
    }
  });
  sales.sort((a,b)=>a.sale_date.localeCompare(b.sale_date));

  const sum=sales.reduce((a,r)=>a+Number(r.amount||0),0);
  const pct=goal>0 ? Math.min(100,(sum/goal)*100) : 0;
  const falt=goal>0 ? Math.max(0,goal-sum) : 0;

  $("metaSummary").innerHTML = goal>0
    ? `Vendido: <b>$${fmtNum(sum)}</b> de <b>$${fmtNum(goal)}</b> ‚Äî Avance: <b>${pct.toFixed(1)}%</b> ‚Äî Falta: <b>$${fmtNum(falt)}</b>`
    : `Guarda una meta para este mes.`;

  $("metaBar").style.width=pct+"%";

  if(!sales.length){ $("salesTable").innerHTML = `<div class="mini">Sin ventas locales del mes.</div>`; return; }
  let html=`<table><thead><tr><th>Fecha</th><th class="right">Venta</th><th>Nota</th></tr></thead><tbody>`;
  sales.forEach(r=> html+=`<tr><td>${r.sale_date}</td><td class="right">$${fmtNum(r.amount)}</td><td>${r.note||""}</td></tr>`);
  html+=`</tbody></table>`;
  $("salesTable").innerHTML=html;
}

/* ===== ADMIN via RPC ===== */
$("adminFrom").value=todayISO();
$("adminTo").value=todayISO();

$("btnAdminReload").onclick=adminReload;
$("btnAdminExcel").onclick=()=> exportExcel("Admin_Visitas", window.__adminRows || []);

async function adminReload(){
  const pin = ($("adminPin").value.trim() || localStorage.getItem(PIN_KEY) || "").trim();
  if(!pin) { $("adminTable").innerHTML=`<div class="mini">Escribe/guarda el PIN admin.</div>`; return; }

  const from=$("adminFrom").value;
  const to=$("adminTo").value;

  try{
    const { data, error } = await sb.rpc("admin_get_visits", { p_pin: pin, p_from: from, p_to: to });
    if(error) throw error;

    window.__adminRows = data || [];
    if(!data?.length){ $("adminTable").innerHTML=`<div class="mini">Sin visitas en ese rango.</div>`; return; }

    let html=`<table><thead><tr><th>Fecha</th><th>Vendedor</th><th>Cliente</th><th>Motivo</th><th class="right">Dur</th><th>Mapa</th></tr></thead><tbody>`;
    data.forEach(r=>{
      const map=(r.end_lat && r.end_lng) ? `https://www.google.com/maps?q=${r.end_lat},${r.end_lng}` : "";
      html+=`<tr>
        <td>${fmtDT(r.created_at)}</td>
        <td>${r.seller}</td>
        <td>${r.client_name}</td>
        <td>${r.reason}</td>
        <td class="right">${r.duration_min}</td>
        <td>${map ? `<a href="${map}" target="_blank" rel="noopener">Ver</a>` : "‚Äî"}</td>
      </tr>`;
    });
    html+=`</tbody></table>`;
    $("adminTable").innerHTML=html;

  }catch(e){
    $("adminTable").innerHTML=`<div class="mini" style="color:#dc2626;font-weight:900;">${e.message || e}</div>`;
  }
}
</script>

<script>
  if("serviceWorker" in navigator){
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  }
</script>

</body>
</html>

